<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Archive | Dept Info Board</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1E1B4B',
            accent: '#38BDF8',
            background: '#F8FAFC',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-background text-gray-800 font-sans">

  <!-- ✅ Navbar -->
  <nav class="bg-primary text-white shadow-md fixed w-full z-40 h-20">
    <div class="max-w-7xl mx-auto px-4 h-full flex items-center justify-between relative">
      <div class="absolute left-4 flex items-center">
        <img src="Images/futo.jpeg" alt="Dept Logo" class="h-10 w-10 object-contain" />
      </div>
      <h1 class="absolute left-1/2 transform -translate-x-1/2 text-lg md:text-xl font-bold text-center">
        Dept Info Board
      </h1>
      <div class="absolute right-4">
        <button id="menu-btn" class="md:hidden text-accent focus:outline-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <!-- Mobile Sidebar -->
  <aside id="mobile-menu"
    class="fixed top-0 right-0 h-full w-64 bg-primary text-white transform translate-x-full transition-transform duration-300 md:hidden z-40 shadow-lg">
    <div class="flex justify-between items-center px-4 py-3 border-b border-accent/30">
      <h2 class="text-lg font-semibold">Menu</h2>
      <button id="close-btn" class="text-accent">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <nav class="flex flex-col py-6 space-y-4 pl-6 text-lg">
      <a href="index.html" class="hover:text-accent">Home</a>
      <a href="about.html" class="hover:text-accent">About</a>
      <a href="announcements.html" class="hover:text-accent">Announcements</a>
      <a href="timetables.html" class="hover:text-accent">Timetables</a>
      <a href="events.html" class="hover:text-accent">Events</a>
      <a href="archive.html" class="hover:text-accent">Archive</a>
      <a href="login.html" class="bg-accent text-primary px-3 py-1 rounded-md w-fit">Admin</a>
    </nav>
  </aside>

  <!-- Desktop Sidebar -->
  <aside class="hidden md:flex fixed top-0 right-0 h-full w-60 bg-primary text-white flex-col py-24 space-y-6 pl-6 text-lg shadow-lg">
    <a href="index.html" class="hover:text-accent">Home</a>
    <a href="about.html" class="hover:text-accent">About</a>
    <a href="announcements.html" class="hover:text-accent">Announcements</a>
    <a href="timetables.html" class="hover:text-accent">Timetables</a>
    <a href="events.html" class="hover:text-accent">Events</a>
    <a href="archive.html" class="hover:text-accent">Archive</a>
    <a href="login.html" class="bg-accent text-primary px-3 py-1 rounded-md w-fit">Admin</a>
  </aside>

  <!-- Main Content -->
  <main class="pt-24 md:mr-60 px-4">
    <section class="max-w-6xl mx-auto py-12">
      <h2 class="text-3xl md:text-4xl font-bold text-primary mb-6 text-center">Archive</h2>
      <p class="text-gray-600 mb-6 text-justify">
        Browse past announcements, timetables, and events from the department. 
        Use the search and filter options below to quickly find what you need.
      </p>

      <!-- ✅ Tabs (Desktop) -->
      <div class="hidden md:flex justify-center mb-6 space-x-4">
        <button class="tab-btn bg-accent text-primary px-4 py-2 rounded-lg font-medium" data-tab="announcements">Announcements</button>
        <button class="tab-btn bg-gray-200 text-primary px-4 py-2 rounded-lg font-medium" data-tab="events">Events</button>
        <button class="tab-btn bg-gray-200 text-primary px-4 py-2 rounded-lg font-medium" data-tab="timetables">Timetables</button>
      </div>

      <!-- ✅ Dropdown (Mobile) -->
      <div class="md:hidden mb-6">
        <select id="tabSelect" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-accent">
          <option value="announcements" selected>Announcements</option>
          <option value="events">Events</option>
          <option value="timetables">Timetables</option>
        </select>
      </div>

      <!-- 🔎 Search & Filter -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
        <div class="relative w-full md:w-1/2">
          <input 
            type="text" 
            id="searchInput" 
            placeholder="Search archive..." 
            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-accent"
          />
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute right-3 top-2.5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1010.5 18a7.5 7.5 0 006.15-3.35z" />
          </svg>
        </div>
        <div>
          <select id="filterSelect" class="px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-accent">
            <option value="all">All</option>
            <option value="recent">Most Recent</option>
            <option value="oldest">Oldest</option>
            <option value="100L">100 Level</option>
            <option value="200L">200 Level</option>
            <option value="300L">300 Level</option>
            <option value="400L">400 Level</option>
            <option value="500L">500 Level</option>
          </select>
        </div>
      </div>

      <!-- ✅ Archive Sections -->
      <div id="archive-sections">
        <!-- Announcements -->
        <div id="announcements" class="archive-list grid gap-6">
          <!-- Archived Announcements will load here -->
        </div>

        <!-- Events -->
        <div id="events" class="archive-list grid gap-6 hidden">
          <!-- Archived Events will load here -->
        </div>

        <!-- Timetables -->
        <div id="timetables" class="archive-list grid gap-6 hidden">
           <!-- Archived Timetables will load here -->
        </div>
      </div>
    </section>
  </main>

  <!-- ✅ Footer -->
  <footer class="bg-primary text-white md:mr-60">
    <div class="max-w-6xl mx-auto px-6 py-10 grid md:grid-cols-2 gap-8">
      <div>
        <h3 class="text-xl font-semibold mb-3 text-accent">Stay Connected</h3>
        <p class="text-gray-200 text-sm leading-relaxed">
          The Archive helps students and staff access previous departmental updates, ensuring
          transparency and continuity across academic sessions.
        </p>
      </div>
      <div>
        <h3 class="text-xl font-semibold mb-3 text-accent">Quick Links</h3>
        <ul class="space-y-2 text-sm">
          <li><a href="index.html" class="hover:text-accent">Home</a></li>
          <li><a href="announcements.html" class="hover:text-accent">Announcements</a></li>
          <li><a href="timetables.html" class="hover:text-accent">Timetables</a></li>
          <li><a href="events.html" class="hover:text-accent">Events</a></li>
        </ul>
      </div>
    </div>
    <div class="bg-primary text-center py-4 border-t border-accent/30">
      <p class="text-sm md:text-base text-gray-200">
        &copy; 2025 Department of Cyber Security, FUTO. All rights reserved.
      </p>
    </div>
  </footer>

  <!-- Back to Top -->
  <button id="backToTop" 
    class="hidden fixed bottom-6 right-6 bg-accent text-primary p-3 rounded-full shadow-lg hover:bg-accent/80 transition z-50"
    aria-label="Back to top">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
    </svg>
  </button>

  <!-- ✅ JS -->
<script>
  // Mobile Menu
  const menuBtn = document.getElementById('menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const closeBtn = document.getElementById('close-btn');
  if (menuBtn && mobileMenu && closeBtn) {
    menuBtn.addEventListener('click', () => {
      mobileMenu.classList.remove('translate-x-full');
      mobileMenu.classList.add('translate-x-0');
    });
    closeBtn.addEventListener('click', () => {
      mobileMenu.classList.remove('translate-x-0');
      mobileMenu.classList.add('translate-x-full');
    });
  }

  // Back to Top
  const backToTopBtn = document.getElementById('backToTop');
  window.addEventListener('scroll', () => {
    if (window.scrollY > 200) backToTopBtn.classList.remove('hidden');
    else backToTopBtn.classList.add('hidden');
  });
  backToTopBtn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // Tabs + Dropdown
  const tabs = document.querySelectorAll(".tab-btn");
  const sections = document.querySelectorAll(".archive-list");
  const tabSelect = document.getElementById("tabSelect");
  const searchInput = document.getElementById("searchInput");
  const filterSelect = document.getElementById("filterSelect");

// Tab Switching (Desktop)
tabs.forEach(tab => {
  tab.addEventListener("click", () => {
    tabs.forEach(btn => {
      btn.classList.remove("bg-accent", "text-primary");
      btn.classList.add("bg-gray-200", "text-gray-700"); // inactive state
    });

    tab.classList.remove("bg-gray-200", "text-gray-700");
    tab.classList.add("bg-accent", "text-primary"); // active state

    sections.forEach(sec => sec.classList.add("hidden"));
    document.getElementById(tab.dataset.tab).classList.remove("hidden");

    tabSelect.value = tab.dataset.tab;
  });
});

  // Dropdown Switching (Mobile)
  tabSelect.addEventListener("change", () => {
    const selected = tabSelect.value;

    sections.forEach(sec => sec.classList.add("hidden"));
    document.getElementById(selected).classList.remove("hidden");

    tabs.forEach(btn => {
      if (btn.dataset.tab === selected) {
        btn.classList.add("bg-accent", "text-primary");
        btn.classList.remove("bg-gray-200");
      } else {
        btn.classList.remove("bg-accent", "text-primary");
        btn.classList.add("bg-gray-200");
      }
    });
  });

  // ✅ Load archived posts from backend
  async function loadArchive() {
    try {
      const res = await fetch("http://localhost:4000/api/posts?status=archived");
      if (!res.ok) throw new Error("Failed to fetch archive");
      const { items } = await res.json();

      // Clear old
      document.getElementById("announcements").innerHTML = "";
      document.getElementById("events").innerHTML = "";
      document.getElementById("timetables").innerHTML = "";

      if (items.length === 0) {
        document.getElementById("announcements").innerHTML =
        document.getElementById("events").innerHTML =
        document.getElementById("timetables").innerHTML =
          `<p class="text-gray-600">No archived posts yet.</p>`;
        return;
      }

      items.forEach(post => {
        const div = document.createElement("div");
        div.className = "bg-white p-6 rounded-xl shadow hover:shadow-lg transition";
        div.dataset.date = post.date || post.createdAt;
        div.dataset.level = post.level || "all";
        div.dataset.type = post.type;

        div.innerHTML = `
          <h3 class="text-xl font-semibold text-primary mb-2">
            ${post.type === "announcement" ? "📢" :
              post.type === "event" ? "🎤" : "📝"} ${post.title}
          </h3>
          <p class="text-gray-700 mb-2">${post.content || ""}</p>
          ${post.fileUrl && post.type === "timetable" ? 
            `<a href="${post.fileUrl}" target="_blank" 
              class="text-accent font-semibold hover:underline">View / Download File</a>` : ""}
          <span class="text-sm text-gray-500">Archived on ${new Date(post.updatedAt).toLocaleDateString()}</span>
        `;

        document.getElementById(post.type + "s").appendChild(div);
      });

    } catch (err) {
      console.error("Error loading archive:", err);
      document.getElementById("announcements").innerHTML =
        `<p class="text-red-500">Error loading archive.</p>`;
    }
  }

  // ✅ Filtering
  function filterItems() {
    const activeTab = document.querySelector(".tab-btn.bg-accent").dataset.tab;
    const container = document.getElementById(activeTab);
    const query = searchInput.value.toLowerCase();
    const filterValue = filterSelect.value;
    let cards = Array.from(container.children);

    cards.forEach(card => {
      const text = card.innerText.toLowerCase();
      let matchesSearch = text.includes(query);
      let matchesFilter = true;

      if (filterValue !== "all") {
        if (["100L","200L","300L","400L","500L"].includes(filterValue)) {
          matchesFilter = (card.dataset.level === filterValue);
        }
      }

      card.style.display = (matchesSearch && matchesFilter) ? "block" : "none";
    });

    if (filterValue === "recent") {
      cards.sort((a, b) => new Date(b.dataset.date) - new Date(a.dataset.date));
      container.innerHTML = "";
      cards.forEach(c => container.appendChild(c));
    } else if (filterValue === "oldest") {
      cards.sort((a, b) => new Date(a.dataset.date) - new Date(b.dataset.date));
      container.innerHTML = "";
      cards.forEach(c => container.appendChild(c));
    }
  }

  searchInput.addEventListener("input", filterItems);
  filterSelect.addEventListener("change", filterItems);

  // ✅ Run on page load
  loadArchive();
</script>

</body>
</html>
